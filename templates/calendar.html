<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/navbar.css') }}">
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/main.css') }}">
    <title>Calendar</title>

</head>
<body>
    {% include "navbar.html" %}
    <div class="main-container">
        <h1>Actions Calendar</h1>

        <div class="calendar">
            <div class="calendar-header">
                <button id="prevMonthBtn">&lt;</button>
                <span class="calendar-month-year" id="currentMonthYear"></span>
                <button id="nextMonthBtn">&gt;</button>
            </div>
            <div class="calendar-body" id="calendarBody"></div>
        </div>
        <div class ="calendarModal"></div>
    </div>
</body>
<script>
    document.addEventListener('DOMContentLoaded', function() {
    const calendarBody = document.getElementById('calendarBody');
    const currentMonthYear = document.getElementById('currentMonthYear');
    const prevMonthBtn = document.getElementById('prevMonthBtn');
    const nextMonthBtn = document.getElementById('nextMonthBtn');

    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();

    // Load calendar data from JSON file
    fetch('/static/json/calendar_data.json')
        .then(response => response.json())
        .then(calendarData => {

            function renderCalendar() {
                // Clear previous calendar
                calendarBody.innerHTML = '';

                // Set current month and year
                currentMonthYear.textContent = `${new Intl.DateTimeFormat('en-US', { month: 'long' }).format(currentDate)} ${currentYear}`;

                // Create and append day names
                const dayNames = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
                dayNames.forEach(day => {
                    let dayNameCell = document.createElement('div');
                    dayNameCell.textContent = day;
                    dayNameCell.classList.add('day-name');
                    calendarBody.appendChild(dayNameCell);
                });

                // Get the first day of the month
                let firstDayOfMonth = new Date(currentYear, currentMonth, 1);
                console.log(firstDayOfMonth.getDay());

                // Calculate the offset needed to align the first day with Monday (0 for Sunday, 1 for Monday, etc.)
                let startOfWeek = 1; // Monday
                offset = firstDayOfMonth.getDay();

                // Calculate the adjusted first day of the month
                let adjustedFirstDayOfMonth = new Date(currentYear, currentMonth, 1 - offset);

                // Get the number of days in the month
                let daysInMonth = new Date(currentYear, currentMonth + 1, 0).getDate();

                // Create calendar cells for dates with events
                for (let i = 1; i <= daysInMonth + offset; i++) {
    let currentDateKey;
    let calendarDay = document.createElement('div');
    
    if (i > offset) {
        let dayOfMonth = i - offset ;
        currentDateKey = new Date(currentYear, currentMonth, dayOfMonth+1).toISOString().slice(0, 10);

        calendarDay.textContent = dayOfMonth;
        calendarDay.classList.add('calendar-day');

        if (currentDate.getDate() === dayOfMonth && currentDate.getMonth() === currentMonth && currentDate.getFullYear() === currentYear) {
            calendarDay.classList.add('current-day');
        }

        const events = calendarData[currentDateKey] || [];
        
        if (events.length > 0) {
            console.log(currentDateKey)
            const eventTitles = events.map(event => event.title).join(', ');
            const eventDescriptions = events.map(event => event.description).join(', ');
            const eventMarker = document.createElement('div');
            eventMarker.textContent = eventTitles;
            eventMarker.classList.add('event-marker');
            calendarDay.appendChild(eventMarker);

            calendarDay.addEventListener('click', function() {
                // Handle click event for calendar day
                let selectedDate = new Date(currentYear, currentMonth, dayOfMonth);
                alert(`${selectedDate.toLocaleDateString()}  \n  ${eventDescriptions}`);
            });
        }
    } else {
        calendarDay.classList.add('calendar-day', 'empty');
    }

    calendarBody.appendChild(calendarDay);
}

            }

            // Initial rendering of the calendar
            renderCalendar();

            // Event listeners for navigating months
            prevMonthBtn.addEventListener('click', function() {
                currentMonth--;
                if (currentMonth < 0) {
                    currentMonth = 11;
                    currentYear--;
                }
                currentDate = new Date(currentYear, currentMonth);
                renderCalendar();
            });

            nextMonthBtn.addEventListener('click', function() {
                currentMonth++;
                if (currentMonth > 11) {
                    currentMonth = 0;
                    currentYear++;
                }
                currentDate = new Date(currentYear, currentMonth);
                renderCalendar();
            });
        })
        .catch(error => console.error('Error loading calendar data:', error));
});

</script>
</html>
